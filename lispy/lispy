#! /usr/bin/python
 
import string,sys
from core import *
from input import *

def main():
    E = Environment(None)

    ### First read-in builtin lisp functions
    input = Input(open("./rc.lisp","r"),E)
    while True:
        expr = input.read()
        if iserror(expr) and expr.string=='EOF':
            break
        val = lisp_eval( expr, E )
        if iserror(val):
            print "Error in builtins.lp"
            print val
            return 1

    input = Input(sys.stdin,E)
    while True:
        expr = input.read()
        if iserror(expr) and expr.string=='EOF':
            break
        val = lisp_eval( expr, E )
        if input.input == sys.stdin:
            print val
        if isinstance(val,Exception) and not sys.stdin.isatty():
            return 2
    if input.input == sys.stdin:
        print

if __name__=='__main__':
    main()
